<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta
        http-equiv="X-UA-Compatible"
        content="IE=edge"
    >
    <meta
        name="viewport"
        content="width=device-width, initial-scale=1.0"
    >
    <title>Export Report Mobifone</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.25.0/axios.min.js"></script>
</head>

<body>
    <label for="month">Tháng:</label>
    <input
        type="number"
        id="month"
        name="month"
    ><br><br>
    <label for="year">Năm:</label>
    <input
        type="number"
        id="year"
        name="year"
    ><br><br>
    <button id="create"> Tạo báo cáo </button><br><br>
    <!-- <label for="file">Downloading progress:</label>
    <progress
        id="file"
        value="0"
        max="100"
    > 0% </progress> -->
</body>
<script>

    function downloadFile(data, fileName) {
        var a = document.createElement("a");
        var mediaType = "data:application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;base64,";
        a.href = mediaType + data
        a.download = fileName + ".xlsx";
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
    }

    function makeGetRequest(path) {
        return new Promise(function (resolve, reject) {
            axios.get(path).then(
                (response) => {
                    var result = response.data;
                    console.log('Processing Request');
                    resolve(result);
                },
                (error) => {
                    reject(error);
                }
            );
        });
    }

    async function main(month, year) {
        var result = await makeGetRequest(`http://localhost:8686/api/report?month=${month}&year=${year}`);
        downloadFile(result, `data-${month}-${year}`)
    }


    $(document).ready(function () {
        $("#create").click((e) => {

            let month = $('#month')[0].value
            let year = $('#year')[0].value

            console.log(month, year);

            main(month, year)

        });
    })

</script>

</html>